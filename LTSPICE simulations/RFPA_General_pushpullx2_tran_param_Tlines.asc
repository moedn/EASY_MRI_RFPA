Version 4
SHEET 1 5344 3112
WIRE 560 -1712 -1232 -1712
WIRE -2128 -1328 -2128 -1360
WIRE -2000 -1328 -2000 -1360
WIRE -2000 -1232 -2000 -1248
WIRE -560 -1232 -560 -1296
WIRE -208 -1232 -208 -1264
WIRE -656 -1184 -816 -1184
WIRE 80 -1184 -128 -1184
WIRE 128 -1184 80 -1184
WIRE -656 -1152 -656 -1184
WIRE -128 -1152 -128 -1184
WIRE 80 -1152 80 -1184
WIRE -816 -1120 -816 -1184
WIRE -560 -1120 -560 -1152
WIRE -496 -1120 -560 -1120
WIRE -208 -1120 -208 -1152
WIRE -208 -1120 -304 -1120
WIRE -560 -1088 -560 -1120
WIRE -496 -1088 -496 -1120
WIRE -208 -1088 -208 -1120
WIRE -656 -1040 -656 -1072
WIRE -128 -1040 -128 -1072
WIRE -208 -960 -208 -1008
WIRE -560 -944 -560 -1008
WIRE 1552 -944 1008 -944
WIRE -1232 -864 -1232 -1712
WIRE 560 -864 560 -1712
WIRE 560 -864 -1232 -864
WIRE 560 -832 560 -864
WIRE 1184 -800 1072 -800
WIRE 1296 -800 1264 -800
WIRE 1392 -800 1296 -800
WIRE 1408 -800 1392 -800
WIRE 1072 -784 1072 -800
WIRE 1296 -784 1296 -800
WIRE 1408 -784 1408 -800
WIRE 1008 -560 1008 -944
WIRE 1552 -560 1552 -944
WIRE 1552 -560 1008 -560
WIRE 1552 -528 1552 -560
WIRE -144 -336 -176 -336
WIRE 16 -336 -64 -336
WIRE 368 -320 336 -320
WIRE 464 -320 448 -320
WIRE -144 -240 -208 -240
WIRE 16 -240 16 -336
WIRE 16 -240 -64 -240
WIRE 304 -240 16 -240
WIRE 336 -240 336 -320
WIRE 336 -240 304 -240
WIRE 352 -240 336 -240
WIRE 464 -240 464 -320
WIRE 464 -240 448 -240
WIRE 528 -240 464 -240
WIRE 16 -224 16 -240
WIRE 352 -208 336 -208
WIRE 464 -208 448 -208
WIRE 336 -176 336 -208
WIRE 464 -176 464 -208
WIRE -352 -160 -368 -160
WIRE -256 -160 -272 -160
WIRE -208 -160 -208 -240
WIRE -864 -144 -896 -144
WIRE -768 -144 -784 -144
WIRE 48 -144 16 -144
WIRE -896 -64 -896 -144
WIRE -896 -64 -976 -64
WIRE -880 -64 -896 -64
WIRE -768 -64 -768 -144
WIRE -768 -64 -784 -64
WIRE -704 -64 -768 -64
WIRE -672 -64 -704 -64
WIRE -560 -64 -592 -64
WIRE -496 -64 -560 -64
WIRE -400 -64 -400 -96
WIRE -400 -64 -432 -64
WIRE -368 -64 -368 -160
WIRE -368 -64 -400 -64
WIRE -352 -64 -368 -64
WIRE -256 -64 -256 -160
WIRE -256 -64 -272 -64
WIRE -208 -64 -208 -96
WIRE -208 -64 -256 -64
WIRE -160 -64 -208 -64
WIRE -128 -64 -160 -64
WIRE -32 -64 -48 -64
WIRE -32 -48 -32 -64
WIRE 48 -48 16 -48
WIRE -880 -32 -896 -32
WIRE -768 -32 -784 -32
WIRE -704 -32 -704 -64
WIRE -560 -32 -560 -64
WIRE -896 0 -896 -32
WIRE -768 0 -768 -32
WIRE -400 0 -400 -64
WIRE 16 48 16 32
WIRE 16 64 16 48
WIRE -400 96 -400 80
WIRE -400 96 -432 96
WIRE 16 160 16 144
WIRE -144 272 -176 272
WIRE 16 272 -64 272
WIRE 176 288 144 288
WIRE 272 288 256 288
WIRE -144 368 -208 368
WIRE 16 368 16 272
WIRE 16 368 -64 368
WIRE 144 368 144 288
WIRE 144 368 16 368
WIRE 160 368 144 368
WIRE 272 368 272 288
WIRE 272 368 256 368
WIRE 304 368 304 -240
WIRE 304 368 272 368
WIRE 16 384 16 368
WIRE 160 400 144 400
WIRE 272 400 256 400
WIRE 144 432 144 400
WIRE 272 432 272 400
WIRE -352 448 -368 448
WIRE -256 448 -272 448
WIRE -208 448 -208 368
WIRE -1152 464 -1184 464
WIRE -1056 464 -1072 464
WIRE 48 464 16 464
WIRE -1184 544 -1184 464
WIRE -1184 544 -1264 544
WIRE -1168 544 -1184 544
WIRE -1056 544 -1056 464
WIRE -1056 544 -1072 544
WIRE -976 544 -976 -64
WIRE -976 544 -1056 544
WIRE -688 544 -976 544
WIRE -656 544 -688 544
WIRE -544 544 -576 544
WIRE -496 544 -544 544
WIRE -400 544 -400 512
WIRE -400 544 -432 544
WIRE -368 544 -368 448
WIRE -368 544 -400 544
WIRE -352 544 -368 544
WIRE -256 544 -256 448
WIRE -256 544 -272 544
WIRE -208 544 -208 512
WIRE -208 544 -256 544
WIRE -160 544 -208 544
WIRE -128 544 -160 544
WIRE -32 544 -48 544
WIRE -32 560 -32 544
WIRE 48 560 16 560
WIRE -1168 576 -1184 576
WIRE -1056 576 -1072 576
WIRE -688 576 -688 544
WIRE -544 576 -544 544
WIRE -1184 608 -1184 576
WIRE -1056 608 -1056 576
WIRE -400 608 -400 544
WIRE 16 656 16 640
WIRE 16 672 16 656
WIRE -400 704 -400 688
WIRE -400 704 -432 704
WIRE 16 768 16 752
WIRE -144 864 -176 864
WIRE 16 864 -64 864
WIRE 368 864 336 864
WIRE 464 864 448 864
WIRE -144 960 -208 960
WIRE 16 960 16 864
WIRE 16 960 -64 960
WIRE 304 960 16 960
WIRE 336 960 336 864
WIRE 336 960 304 960
WIRE 352 960 336 960
WIRE 464 960 464 864
WIRE 464 960 448 960
WIRE 528 960 464 960
WIRE 16 976 16 960
WIRE 352 992 336 992
WIRE 464 992 448 992
WIRE 336 1024 336 992
WIRE 464 1024 464 992
WIRE -352 1040 -368 1040
WIRE -256 1040 -272 1040
WIRE -208 1040 -208 960
WIRE -848 1056 -880 1056
WIRE -752 1056 -768 1056
WIRE 48 1056 16 1056
WIRE -880 1136 -880 1056
WIRE -880 1136 -960 1136
WIRE -864 1136 -880 1136
WIRE -752 1136 -752 1056
WIRE -752 1136 -768 1136
WIRE -688 1136 -752 1136
WIRE -656 1136 -688 1136
WIRE -544 1136 -576 1136
WIRE -496 1136 -544 1136
WIRE -400 1136 -400 1104
WIRE -400 1136 -432 1136
WIRE -368 1136 -368 1040
WIRE -368 1136 -400 1136
WIRE -352 1136 -368 1136
WIRE -256 1136 -256 1040
WIRE -256 1136 -272 1136
WIRE -208 1136 -208 1104
WIRE -208 1136 -256 1136
WIRE -160 1136 -208 1136
WIRE -128 1136 -160 1136
WIRE -32 1136 -48 1136
WIRE -32 1152 -32 1136
WIRE 48 1152 16 1152
WIRE -864 1168 -880 1168
WIRE -752 1168 -768 1168
WIRE -688 1168 -688 1136
WIRE -544 1168 -544 1136
WIRE -880 1200 -880 1168
WIRE -752 1200 -752 1168
WIRE -400 1200 -400 1136
WIRE 16 1248 16 1232
WIRE 16 1264 16 1248
WIRE -400 1296 -400 1280
WIRE -400 1296 -432 1296
WIRE 16 1360 16 1344
WIRE -144 1440 -176 1440
WIRE 16 1440 -64 1440
WIRE 176 1456 144 1456
WIRE 272 1456 256 1456
WIRE -144 1536 -208 1536
WIRE 16 1536 16 1440
WIRE 16 1536 -64 1536
WIRE 144 1536 144 1456
WIRE 144 1536 16 1536
WIRE 160 1536 144 1536
WIRE 272 1536 272 1456
WIRE 272 1536 256 1536
WIRE 304 1536 304 960
WIRE 304 1536 272 1536
WIRE 16 1552 16 1536
WIRE 160 1568 144 1568
WIRE 272 1568 256 1568
WIRE 144 1600 144 1568
WIRE 272 1600 272 1568
WIRE -352 1616 -368 1616
WIRE -256 1616 -272 1616
WIRE -208 1616 -208 1536
WIRE -1136 1632 -1168 1632
WIRE -1040 1632 -1056 1632
WIRE 48 1632 16 1632
WIRE -1168 1712 -1168 1632
WIRE -1168 1712 -1248 1712
WIRE -1152 1712 -1168 1712
WIRE -1040 1712 -1040 1632
WIRE -1040 1712 -1056 1712
WIRE -960 1712 -960 1136
WIRE -960 1712 -1040 1712
WIRE -688 1712 -960 1712
WIRE -656 1712 -688 1712
WIRE -544 1712 -576 1712
WIRE -496 1712 -544 1712
WIRE -400 1712 -400 1680
WIRE -400 1712 -432 1712
WIRE -368 1712 -368 1616
WIRE -368 1712 -400 1712
WIRE -352 1712 -368 1712
WIRE -256 1712 -256 1616
WIRE -256 1712 -272 1712
WIRE -208 1712 -208 1680
WIRE -208 1712 -256 1712
WIRE -160 1712 -208 1712
WIRE -128 1712 -160 1712
WIRE -32 1712 -48 1712
WIRE -32 1728 -32 1712
WIRE 48 1728 16 1728
WIRE -1152 1744 -1168 1744
WIRE -1040 1744 -1056 1744
WIRE -688 1744 -688 1712
WIRE -544 1744 -544 1712
WIRE -1168 1776 -1168 1744
WIRE -1040 1776 -1040 1744
WIRE -400 1776 -400 1712
WIRE 16 1824 16 1808
WIRE 16 1840 16 1824
WIRE -400 1872 -400 1856
WIRE -400 1872 -432 1872
WIRE 16 1936 16 1920
FLAG 16 160 0
FLAG -816 -1040 0
FLAG -2128 -1248 0
FLAG -160 -64 g1p
FLAG 16 48 s1p
FLAG -816 -1184 t
FLAG -400 -96 b1p
FLAG -176 -336 VD
FLAG -432 96 VGbias
FLAG 80 -1072 0
FLAG -128 -1040 0
FLAG -656 -1040 0
FLAG -496 -1088 0
FLAG -304 -1120 VD
FLAG -2128 -1360 VD
FLAG -2000 -1360 VGbias
FLAG -208 -1264 dp
FLAG -208 -960 dn
FLAG 128 -1184 OUT
FLAG -2000 -1152 0
FLAG 1072 -704 0
FLAG 1296 -704 0
FLAG 1408 -720 0
FLAG 1392 -800 OUT_bpf
FLAG 16 768 0
FLAG 528 -240 dp
FLAG -160 544 g2p
FLAG 16 656 s2p
FLAG -400 512 b2p
FLAG -176 272 VD
FLAG -432 704 VGbias
FLAG 16 1360 0
FLAG -160 1136 g1n
FLAG 16 1248 s1n
FLAG -400 1104 b1n
FLAG -176 864 VD
FLAG -432 1296 VGbias
FLAG 16 1936 0
FLAG 528 960 dn
FLAG -160 1712 g2n
FLAG 16 1824 s2n
FLAG -400 1680 b2n
FLAG -176 1440 VD
FLAG -432 1872 VGbias
FLAG -560 -1296 in1p
FLAG -560 -944 in1n
FLAG -560 48 0
FLAG -704 48 0
FLAG -544 656 0
FLAG -688 656 0
FLAG -544 1248 0
FLAG -688 1248 0
FLAG -544 1824 0
FLAG -688 1824 0
FLAG 1552 -528 0
FLAG 560 -832 0
FLAG -1264 544 in1p
FLAG -768 0 0
FLAG -896 0 0
FLAG -1056 608 0
FLAG -1184 608 0
FLAG -1248 1712 in1n
FLAG -752 1200 0
FLAG -880 1200 0
FLAG -1040 1776 0
FLAG -1168 1776 0
FLAG 272 432 0
FLAG 144 432 0
FLAG 464 -176 0
FLAG 336 -176 0
FLAG 272 1600 0
FLAG 144 1600 0
FLAG 464 1024 0
FLAG 336 1024 0
SYMBOL res 0 48 R0
SYMATTR InstName R1
SYMATTR Value {Rs}
SYMBOL res -48 -256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value {Rfb}
SYMBOL cap -224 -160 R0
SYMATTR InstName C1
SYMATTR Value {Cfb}
SYMBOL res -416 -16 R0
SYMATTR InstName R3
SYMATTR Value {Rgbias}
SYMBOL res -256 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value {Rg_damp}
SYMBOL ind -368 -144 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value {Lg_damp}
SYMBOL cap -432 -80 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value {Csource}
SYMBOL voltage -2128 -1344 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value {VD}
SYMBOL ind -160 -320 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L3
SYMATTR Value {Ld}
SYMBOL ind2 -224 -1248 R0
WINDOW 3 1 64 Right 2
SYMATTR Value {KOUT_LP}
SYMATTR InstName L5
SYMATTR Type ind
SYMATTR SpiceLine Rser=50m
SYMBOL ind2 -224 -1104 R0
WINDOW 3 -3 65 Right 2
SYMATTR Value {KOUT_LP}
SYMATTR InstName L6
SYMATTR Type ind
SYMATTR SpiceLine Rser=50m
SYMBOL ind2 -144 -1168 R0
SYMATTR InstName L7
SYMATTR Value {KOUT_LS}
SYMATTR Type ind
SYMBOL res 64 -1168 R0
SYMATTR InstName RL
SYMATTR Value {Rload_HV_SE}
SYMBOL ind2 -544 -1248 M0
WINDOW 3 -6 71 Right 2
SYMATTR Value {KIN_LS}
SYMATTR InstName L8
SYMATTR Type ind
SYMBOL ind2 -544 -1104 M0
WINDOW 3 -6 76 Right 2
SYMATTR Value {KIN_LS}
SYMATTR InstName L9
SYMATTR Type ind
SYMBOL ind2 -640 -1168 M0
SYMATTR InstName L10
SYMATTR Value {KIN_LP}
SYMATTR Type ind
SYMBOL voltage -2000 -1344 R0
WINDOW 3 24 96 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE({VG_init} {VG} {VG_tdelay} {VG_trise} {VG_trise} {VG_tpad*2+tpulse-VG_trise} 10m)
SYMATTR InstName V4
SYMBOL voltage -816 -1136 R0
WINDOW 3 -46 82 Invisible 2
WINDOW 123 -40 28 Right 2
WINDOW 39 -45 52 Right 2
SYMATTR Value SINE(0 {Vin} {f0} {VG_tdelay+VG_tpad} 0 0 {tpulse*f0})
SYMATTR Value2 AC 1
SYMATTR SpiceLine Rser={Rsource_HV_SE}
SYMATTR InstName V2
SYMBOL bv -2000 -1248 R0
SYMATTR InstName B1
SYMATTR Value V={VG*smallsig()}
SYMBOL bv 1072 -800 R0
SYMATTR InstName B2
SYMATTR Value V=V(OUT)
SYMBOL res 1280 -816 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 1
SYMBOL ind 1280 -800 R0
SYMATTR InstName L15
SYMATTR Value {bpf_L}
SYMBOL cap 1392 -784 R0
SYMATTR InstName C9
SYMATTR Value {bpf_C}
SYMBOL nmos -32 -144 R0
SYMATTR InstName M1
SYMATTR Value irf530n
SYMATTR Prefix X
SYMBOL ind 0 -64 R0
SYMATTR InstName L17
SYMATTR Value {Lpar_S}
SYMATTR SpiceLine Rpar={EPR_S}
SYMBOL ind 0 -240 R0
SYMATTR InstName L18
SYMATTR Value {Lpar_D}
SYMATTR SpiceLine Rpar={EPR_D}
SYMBOL ind -144 -48 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L19
SYMATTR Value {Lpar_G}
SYMATTR SpiceLine Rpar={EPR_G}
SYMBOL res 0 656 R0
SYMATTR InstName R18
SYMATTR Value {Rs}
SYMBOL res -48 352 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value {Rfb}
SYMBOL cap -224 448 R0
SYMATTR InstName C10
SYMATTR Value {Cfb}
SYMBOL res -416 592 R0
SYMATTR InstName R20
SYMATTR Value {Rgbias}
SYMBOL res -256 528 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value {Rg_damp}
SYMBOL ind -368 464 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L16
SYMATTR Value {Lg_damp}
SYMBOL cap -432 528 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C11
SYMATTR Value {Csource}
SYMBOL ind -160 288 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L20
SYMATTR Value {Ld}
SYMBOL nmos -32 464 R0
SYMATTR InstName M2
SYMATTR Value irf530n
SYMATTR Prefix X
SYMBOL ind 0 544 R0
SYMATTR InstName L21
SYMATTR Value {Lpar_S}
SYMATTR SpiceLine Rpar={EPR_S}
SYMBOL ind 0 368 R0
SYMATTR InstName L22
SYMATTR Value {Lpar_D}
SYMATTR SpiceLine Rpar={EPR_D}
SYMBOL ind -144 560 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L23
SYMATTR Value {Lpar_G}
SYMATTR SpiceLine Rpar={EPR_G}
SYMBOL res 0 1248 R0
SYMATTR InstName R5
SYMATTR Value {Rs}
SYMBOL res -48 944 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value {Rfb}
SYMBOL cap -224 1040 R0
SYMATTR InstName C3
SYMATTR Value {Cfb}
SYMBOL res -416 1184 R0
SYMATTR InstName R7
SYMATTR Value {Rgbias}
SYMBOL res -256 1120 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value {Rg_damp}
SYMBOL ind -368 1056 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L2
SYMATTR Value {Lg_damp}
SYMBOL cap -432 1120 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value {Csource}
SYMBOL ind -160 880 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L4
SYMATTR Value {Ld}
SYMBOL nmos -32 1056 R0
SYMATTR InstName M3
SYMATTR Value irf530n
SYMATTR Prefix X
SYMBOL ind 0 1136 R0
SYMATTR InstName L11
SYMATTR Value {Lpar_S}
SYMATTR SpiceLine Rpar={EPR_S}
SYMBOL ind 0 960 R0
SYMATTR InstName L12
SYMATTR Value {Lpar_D}
SYMATTR SpiceLine Rpar={EPR_D}
SYMBOL ind -144 1152 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L13
SYMATTR Value {Lpar_G}
SYMATTR SpiceLine Rpar={EPR_G}
SYMBOL res 0 1824 R0
SYMATTR InstName R9
SYMATTR Value {Rs}
SYMBOL res -48 1520 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value {Rfb}
SYMBOL cap -224 1616 R0
SYMATTR InstName C5
SYMATTR Value {Cfb}
SYMBOL res -416 1760 R0
SYMATTR InstName R11
SYMATTR Value {Rgbias}
SYMBOL res -256 1696 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value {Rg_damp}
SYMBOL ind -368 1632 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L14
SYMATTR Value {Lg_damp}
SYMBOL cap -432 1696 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value {Csource}
SYMBOL ind -160 1456 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L24
SYMATTR Value {Ld}
SYMBOL nmos -32 1632 R0
SYMATTR InstName M4
SYMATTR Value irf530n
SYMATTR Prefix X
SYMBOL ind 0 1712 R0
SYMATTR InstName L25
SYMATTR Value {Lpar_S}
SYMATTR SpiceLine Rpar={EPR_S}
SYMBOL ind 0 1536 R0
SYMATTR InstName L26
SYMATTR Value {Lpar_D}
SYMATTR SpiceLine Rpar={EPR_D}
SYMBOL ind -144 1728 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L27
SYMATTR Value {Lpar_G}
SYMATTR SpiceLine Rpar={EPR_G}
SYMBOL res -720 -48 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_in}
SYMATTR InstName R13
SYMBOL res -576 -48 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_out}
SYMATTR InstName R14
SYMBOL res -576 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -53 65 VTop 2
SYMATTR InstName R15
SYMATTR Value {atten_Rser}
SYMBOL res -704 560 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_in}
SYMATTR InstName R16
SYMBOL res -560 560 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_out}
SYMATTR InstName R22
SYMBOL res -560 528 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -53 65 VTop 2
SYMATTR InstName R23
SYMATTR Value {atten_Rser}
SYMBOL res -704 1152 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_in}
SYMATTR InstName R24
SYMBOL res -560 1152 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_out}
SYMATTR InstName R25
SYMBOL res -560 1120 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -53 65 VTop 2
SYMATTR InstName R26
SYMATTR Value {atten_Rser}
SYMBOL res -704 1728 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_in}
SYMATTR InstName R27
SYMBOL res -560 1728 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_out}
SYMATTR InstName R28
SYMBOL res -560 1696 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -53 65 VTop 2
SYMATTR InstName R29
SYMATTR Value {atten_Rser}
SYMBOL tline -832 -48 R0
WINDOW 3 -8 -72 Top 2
SYMATTR InstName T1
SYMATTR Value Td={1.5/Vp_in} Z0={Z0_gates}
SYMBOL tline -1120 560 R0
WINDOW 3 -8 -72 Top 2
SYMATTR InstName T2
SYMATTR Value Td={1.7/Vp_in} Z0={Z0_gates}
SYMBOL tline -816 1152 R0
WINDOW 3 -8 -72 Top 2
SYMATTR InstName T3
SYMATTR Value Td={1.5/Vp_in} Z0={Z0_gates}
SYMBOL tline -1104 1728 R0
WINDOW 3 -8 -72 Top 2
SYMATTR InstName T4
SYMATTR Value Td={1.5/Vp_in} Z0={Z0_gates}
SYMBOL tline 208 384 R0
WINDOW 3 -8 -72 Top 2
SYMATTR InstName T5
SYMATTR Value Td={1.5/Vp_in} Z0={Z0_drains}
SYMBOL tline 400 -224 R0
WINDOW 3 -8 -72 Top 2
SYMATTR InstName T6
SYMATTR Value Td={1.0/Vp_in} Z0={Z0_drains}
SYMBOL tline 208 1552 R0
WINDOW 3 -8 -72 Top 2
SYMATTR InstName T7
SYMATTR Value Td={1.5/Vp_in} Z0={Z0_drains}
SYMBOL tline 400 976 R0
WINDOW 3 -8 -72 Top 2
SYMATTR InstName T8
SYMATTR Value Td={1.0/Vp_in} Z0={Z0_drains}
SYMBOL res 464 848 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R30
SYMATTR Value {Tline_Rshunt}
SYMBOL res -1040 1616 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R31
SYMATTR Value {Tline_Rshunt}
SYMBOL res 272 1440 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R32
SYMATTR Value {Tline_Rshunt}
SYMBOL res 464 -336 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R33
SYMATTR Value {Tline_Rshunt}
SYMBOL res 272 272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R34
SYMATTR Value {Tline_Rshunt}
SYMBOL res -768 -160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R35
SYMATTR Value {Tline_Rshunt}
SYMBOL res -1056 448 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R36
SYMATTR Value {Tline_Rshunt}
SYMBOL res -752 1040 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R37
SYMATTR Value {Tline_Rshunt}
TEXT 904 -448 Left 2 !.param Rg_damp=15\n.param Lg_damp=150n
TEXT 960 -240 Left 2 !.net I(RL) V2\n.ac dec 1k 100k 500meg\n;.tran 0 {VG_tdelay+VG_tpad+50u+10/f0} {VG_tdelay+VG_tpad+50u} 1u\n \n; FOR MEASURING COMPRESSION\n;.step oct param Vin_scale 0.0625 1 4\n.meas TRAN Vout_RMS_fund RMS V(OUT_bpf)\n.meas TRAN Av_fund RMS {V(OUT_bpf)/(Vin/1.414)}\n.meas TRAN Pout_fund PARAM {(Vout_RMS_fund**2/Rload_HV_SE)}\n.meas TRAN G_dB PARAM 20*log10(Av_fund)\n.meas TRAN Pbias AVG -V(VD)*I(V1)\n.meas TRAN Efficiency PARAM Pout_fund/Pbias\n \n; SPICE models/subcircuits to include\n.lib irf630_sihf630_PS_formatted.spi\n.lib irf530n.sub\n.lib irf540n.sub\n.lib irf630N.sub
TEXT 1440 -1968 Left 2 ;; IRF530\n.param VD=48\n.param Gm0=4\n.param ID=1\n.param Vth=4.5\n.param Coss=320p
TEXT 1112 -1968 Left 2 ;; IRF510, Ids=1\n.param VD=48\n.param Gm0=1.8\n.param ID=1\n.param Vth=5\n.param Coss=100p
TEXT 1112 -1768 Left 2 ;; IRF510, Ids=2\n.param VD=48\n.param Gm0=2.5\n.param ID=2\n.param Vth=5.3\n.param Coss=100p
TEXT 1112 -1576 Left 2 ;; IRF510, Ids=4\n.param VD=48\n.param Gm0=2.6\n.param ID=4\n.param Vth=6.05\n.param Coss=100p
TEXT 1112 -1392 Left 2 ;; IRF510, Ids=5\n.param VD=48\n.param Gm0=2.75\n.param ID=5\n.param Vth=6.35\n.param Coss=100p
TEXT 1440 -1792 Left 2 ;; IRF530, Ids=2.5\n;.param VD=48\n.param Gm0=4.4\n;.param ID=2.5\n.param Vth=4.75\n.param Coss=320p
TEXT 1440 -1576 Left 2 ;; IRF530, Ids=4\n.param VD=48\n.param Gm0=5.4\n.param ID=4\n.param Vth=5.1\n.param Coss=320p
TEXT 1720 -1584 Left 2 ;; IRF530N, Ids=4\n.param VD=48\n.param Gm0=16\n.param ID=4\n.param Vth=4.0\n.param Coss=130p
TEXT 1720 -1384 Left 2 ;; IRF530N, Ids=5\n.param VD=48\n.param Gm0=16\n.param ID=5\n.param Vth=4.2\n.param Coss=130p
TEXT 1704 -1784 Left 2 !; IRF530N, Ids=2.5\n;.param VD=48\n.param Gm0=16\n;.param ID=2.5\n.param Vth=4.00\n.param Coss=130p
TEXT 1984 -1784 Left 2 ;; IRF540N, Ids=2.5\n.param VD=48\n.param Gm0=15\n.param ID=2.5\n.param Vth=3.8\n.param Coss=250p
TEXT 2256 -1784 Left 2 ;; IRF630, Ids=2.5\n.param VD=48\n.param Gm0=3.7\n.param ID=2.5\n.param Vth=5.28\n.param Coss=240p
TEXT 640 -1688 Left 2 ;trace formulas\nTransconductance of FET Gm0\nIx(M1:D)/V(g,s)\nEffective transconductance Gm\nIx(M1:D)/V(g)\nStability factor\n(1-abs(S11(v2))**2-abs(S22(v2))**2+abs(S11(v2)*S22(v2)-S12(v2)*S21(v2))**2)/(2*abs(S21(v2)*S12(v2)))\njust delta\nS11(v2)*S22(v2)-S12(v2)*S21(v2)
TEXT 2520 -1784 Left 2 ;; IRF630N, Ids=2.5\n;.param VD=48\n.param Gm0=10\n;.param ID=2.5\n.param Vth=4\n.param Coss=240p
TEXT -2240 128 Left 2 !;step 1:\n;Choose :\n;Nfets (number of FETs sharing PEP)\n.param Nfets=4\n.param PEPnet_target=200\n.param Rload_net=50\n;PEP (peak output power) \n;VD (drain bias voltage)\n;VDmin (minimum drain voltage of FET, at max amplitude)\n.param PEP_target={PEPnet_target/Nfets}\n.param VD_target=48\n.param VDmin_target=12\n;Voutpk=VD_target-VDmin_target\n.param Voutpk_target={VD_target-VDmin_target}\n;Rload_LV_SE=Voutpk_target^2/(2*PEP_target)\n.param Rload_LV_SE_target={Voutpk_target**2/(2*PEP_target)}\n \n \n;step 1.1 \n; can use the exact target Rload_LV_SE_target\n.param Rload_LV_SE={Rload_LV_SE_target}\n.param VD=VD_target\n.param PEP=PEP_target\n.param Voutpk=Voutpk_target\n.param VDmin=VDmin_target\n \n; or override it with something realizable with the transformers\n; if I override Rload, then PEP will be allowed  to change\n;.param Rload_LV_SE=12.5\n;.param PEP={PEP_target*Rload_LV_SE/Rload_LV_SE_target}\n; and recalculate other things\n;.param Voutpk={sqrt(Rload_LV_SE*2*PEP_target)}\n;.param VD=VD_target\n;.param VDmin={VD-Voutpk}\n \n;For impedance match on output, set Rout_LV_SE=Rload_LV_SE\n.param Rout_LV_SE={Rload_LV_SE}\n \n;step 2:\n; choose IDmin (minimum drain current of FET, at max amplitude)\n.param IDmin=0.5\n; ID=IDmin+Voutpk/Rload_LV_SE\n.param ID={IDmin+Voutpk/Rload_LV_SE}\n; given Gm0, the Gm of the FET at ID\n; and choose Gm, between 0.1Gm0 and 0.5Gm0\n;.param Gm0=2\n.param Gm=2\n; source resistor Rs=(Gm0-Gm)/(Gm0*Gm)\n.param Rs={(Gm0-Gm)/(Gm0*Gm)}\n; calculate gate bias voltage\n; Vth depends on MOSFET model\n.param VG={ID*Rs+Vth}\n \n;step 3:\n; choose gate bias resistor Rgbias\n.param Rgbias=100\n; choose source resistance\n.param Rsource_LV_SE=12.5\n; in parallel they make Rsource2\n.param Rsource2_LV_SE = {(Rgbias*Rsource_LV_SE)/(Rgbias+Rsource_LV_SE)}\n; calculate feedback resistance Rfb\n.param Rfb=Rout_LV_SE*(1+Gm*Rsource2_LV_SE)-Rsource2_LV_SE\n \n;step 4:\n; choose f0/w0\n.param f0=2.7e6\n.param w0={2*3.14159*f0}\n; calculate blocking caps\n; choose cutoff fc=f0/fcratio\n.param fcratio_fb=10\n.param fcratio_source=5\n;.param fc={f0/fcratio}\n;.param wc={w0/fcratio}\n.param Cfb={fcratio_fb/(w0*Rfb)}\n.param Csource={fcratio_source/(w0*Rsource_LV_SE)}\n; calculate drain bias inductor to cancel Coss\n;.param Coss=100p\n.param Ld={1/w0**2/Coss}\n \n; calculate Rin, looking from Rsource\n.param Rin_LV_SE={Rgbias*(Rfb+Rload_LV_SE)/(Rgbias*(Gm*Rload_LV_SE+1)+Rfb+Rload_LV_SE)}
TEXT 968 312 Left 2 !.meas PEP PARAM {PEP}\n.meas VD PARAM {VD}\n.meas VDmin PARAM {VDmin}\n.meas Rload_LV_SE_target PARAM {Rload_LV_SE_target}\n.meas Rload_LV_SE PARAM {Rload_LV_SE}\n.meas IDmin PARAM {IDmin}\n.meas ID PARAM {ID}\n.meas Gm0 PARAM {Gm0}\n.meas Gm PARAM {Gm}\n.meas Rs PARAM {Rs}\n.meas Rgbias PARAM {Rgbias}\n.meas Rsource_LV_SE PARAM {Rsource_LV_SE}\n.meas Rfb PARAM {Rfb}\n.meas Cfb PARAM {Cfb}\n.meas Csource PARAM {Csource}\n.meas Rin_LV_SE PARAM {Rin_LV_SE}\n.meas VG PARAM {VG}\n.meas Coss PARAM {Coss}\n.meas Ld PARAM {Ld}\n.meas KIN_LP PARAM {KIN_LP}\n.meas KIN_LS PARAM {KIN_LS}\n.meas KOUT_LP PARAM {KOUT_LP}\n.meas KOUT_LS PARAM {KOUT_LS}\n.meas Rload_HV_SE PARAM {Rload_HV_SE}\n.meas Rsource_HV_SE PARAM {Rsource_HV_SE}
TEXT -256 -1592 Left 2 !KOUT L5 L6 L7 1\n;inductance per each unit winding\n.param KOUT_AL=10u\n;winding on each side of low voltage center-tapped side\n.param KOUT_N_LV=1\n.param KOUT_N_HV=4\n.param KOUT_LP={KOUT_N_LV**2*KOUT_AL}\n.param KOUT_LS={KOUT_N_HV**2*KOUT_AL}\n.param Rload_HV_SE={2*Rload_LV_SE*KOUT_LS/(4*KOUT_LP)/(Nfets/2)}
TEXT -1184 -1600 Left 2 !KIN L10 L8 L9 1\n;inductance per each unit winding\n.param KIN_AL=10u\n;winding on each side of low voltage center-tapped side\n.param KIN_N_LV=1\n.param KIN_N_HV=4\n.param KIN_LP={KIN_N_HV**2*KOUT_AL}\n.param KIN_LS={KIN_N_LV**2*KOUT_AL}\n.param Rsource_HV_SE={2*Rsource_LV_SE*KIN_LP/(4*KIN_LS)/(Nfets/2)}
TEXT -2240 -1096 Left 2 !.param tpulse=1m\n.param VG_tpad=50u\n.param VG_trise=10u\n.param VG_tdelay=50u\n.param VG_init = 0
TEXT -1016 -976 Left 2 !.param Vin_scale=1\n.param Vin={20*Vin_scale}
TEXT 1120 -656 Left 2 !.param bpf_Q=10\n.param bpf_C={bpf_Q/(w0)}\n.param bpf_L={1/(bpf_Q*w0)}
TEXT 1080 1600 Left 2 !.param Lpar_S=7.5n\n.param EPR_S=100\n.param Lpar_D=4.5n\n.param EPR_D=100\n.param Lpar_G=7.5n\n.param EPR_G=100
TEXT -736 2128 Left 2 !;.param atten_Rin={Rsource_LV_SE}\n;.param atten_Rout={Rin_LV_SE}\n.param atten_Rin=12.5\n.param atten_Rout=12.5\n.param atten_dB=3\n;atten_Rin\n;atten_Rout\n;atten_Vout\n.param atten_Vout={sqrt(atten_Rout/atten_Rin/(10**(atten_dB*0.1)))}\n;.param atten_Rshunt_in={((atten_Rout*atten_Rin)-(atten_Rin**2)*(atten_Vout**2))}\n.param atten_Rshunt_in={((atten_Rout*atten_Rin)-(atten_Rin**2)*(atten_Vout**2))/(atten_Rout+(atten_Rin*atten_Vout**2)-(2*atten_Rin*atten_Vout))}\n.param atten_Rshunt_out={atten_Vout/(1/atten_Rin-atten_Vout/atten_Rout-1/atten_Rshunt_in)}\n.param atten_Rser={((1-atten_Vout)*(atten_Rin*atten_Rshunt_in))/(atten_Rshunt_in-atten_Rin)}\n.meas atten_Vout PARAM {atten_Vout}\n.meas atten_Rshunt_in PARAM {atten_Rshunt_in}\n.meas atten_Rshunt_out PARAM {atten_Rshunt_out}\n.meas atten_Rser PARAM {atten_Rser}
TEXT 1280 -896 Center 2 ;BPF for measuring fundamental \ncomponent of RFPA output
TEXT -648 -1656 Left 2 ;Input/output transformer baluns
TEXT 1072 1120 Left 2 !; input/gate traces are 24mil\n; output/drain traces are 32mil\n; substrate is 62mils\n.param Z0_gates = 109\n.param Z0_drains = 98.25\n; effective permittivity\n.param e_eff=2.8\n; propagation velocity, in m/s\n.param Vp_m={3e8/sqrt(e_eff)}\n; propagation velocity, in inches/s\n.param Vp_in={Vp_m*100/2.54}\n; for shunting out Tlines\n.param Tline_Rshunt=1meg
TEXT 1080 1504 Left 2 !.step param Tline_Rshunt LIST 1m 1meg
