Version 4
SHEET 1 5344 3112
WIRE 560 -1712 -1232 -1712
WIRE -2128 -1328 -2128 -1360
WIRE -2000 -1328 -2000 -1360
WIRE -2000 -1232 -2000 -1248
WIRE -560 -1232 -560 -1296
WIRE -208 -1232 -208 -1264
WIRE -656 -1184 -816 -1184
WIRE 80 -1184 -128 -1184
WIRE 128 -1184 80 -1184
WIRE -656 -1152 -656 -1184
WIRE -128 -1152 -128 -1184
WIRE 80 -1152 80 -1184
WIRE -816 -1120 -816 -1184
WIRE -560 -1120 -560 -1152
WIRE -496 -1120 -560 -1120
WIRE -208 -1120 -208 -1152
WIRE -208 -1120 -304 -1120
WIRE -560 -1088 -560 -1120
WIRE -496 -1088 -496 -1120
WIRE -208 -1088 -208 -1120
WIRE -656 -1040 -656 -1072
WIRE -128 -1040 -128 -1072
WIRE -208 -960 -208 -1008
WIRE -560 -944 -560 -1008
WIRE 1552 -944 1008 -944
WIRE -1232 -864 -1232 -1712
WIRE 560 -864 560 -1712
WIRE 560 -864 -1232 -864
WIRE 560 -832 560 -864
WIRE 1184 -800 1072 -800
WIRE 1296 -800 1264 -800
WIRE 1392 -800 1296 -800
WIRE 1408 -800 1392 -800
WIRE 1072 -784 1072 -800
WIRE 1296 -784 1296 -800
WIRE 1408 -784 1408 -800
WIRE -1344 -720 -1392 -720
WIRE -1328 -720 -1328 -752
WIRE -1328 -720 -1344 -720
WIRE -1280 -720 -1328 -720
WIRE -1344 -704 -1344 -720
WIRE -1344 -640 -1392 -640
WIRE -1328 -640 -1344 -640
WIRE -1280 -640 -1328 -640
WIRE -960 -624 -1008 -624
WIRE -896 -624 -896 -672
WIRE -896 -624 -960 -624
WIRE -1344 -608 -1392 -608
WIRE -1328 -608 -1328 -640
WIRE -1328 -608 -1344 -608
WIRE -1280 -608 -1328 -608
WIRE -960 -608 -960 -624
WIRE -1344 -592 -1344 -608
WIRE 1008 -560 1008 -944
WIRE 1552 -560 1552 -944
WIRE 1552 -560 1008 -560
WIRE -960 -544 -1008 -544
WIRE -896 -544 -960 -544
WIRE -1344 -528 -1392 -528
WIRE -1328 -528 -1344 -528
WIRE -1280 -528 -1328 -528
WIRE -896 -528 -896 -544
WIRE -848 -528 -896 -528
WIRE 1552 -528 1552 -560
WIRE -960 -512 -1008 -512
WIRE -896 -512 -896 -528
WIRE -896 -512 -960 -512
WIRE -1344 -496 -1392 -496
WIRE -1328 -496 -1328 -528
WIRE -1328 -496 -1344 -496
WIRE -1280 -496 -1328 -496
WIRE -960 -496 -960 -512
WIRE -1344 -480 -1344 -496
WIRE -960 -432 -1008 -432
WIRE -896 -432 -960 -432
WIRE -1344 -416 -1392 -416
WIRE -1328 -416 -1344 -416
WIRE -1280 -416 -1328 -416
WIRE -1344 -384 -1392 -384
WIRE -1328 -384 -1328 -416
WIRE -1328 -384 -1344 -384
WIRE -1280 -384 -1328 -384
WIRE -896 -384 -896 -432
WIRE -1344 -368 -1344 -384
WIRE -144 -336 -176 -336
WIRE 16 -336 -64 -336
WIRE -1344 -304 -1392 -304
WIRE -1328 -304 -1344 -304
WIRE -1280 -304 -1328 -304
WIRE -1328 -272 -1328 -304
WIRE -144 -240 -208 -240
WIRE 16 -240 16 -336
WIRE 16 -240 -64 -240
WIRE 80 -240 16 -240
WIRE 16 -224 16 -240
WIRE -352 -160 -368 -160
WIRE -256 -160 -272 -160
WIRE -208 -160 -208 -240
WIRE 48 -144 16 -144
WIRE -704 -64 -784 -64
WIRE -672 -64 -704 -64
WIRE -560 -64 -592 -64
WIRE -496 -64 -560 -64
WIRE -400 -64 -400 -96
WIRE -400 -64 -432 -64
WIRE -368 -64 -368 -160
WIRE -368 -64 -400 -64
WIRE -352 -64 -368 -64
WIRE -256 -64 -256 -160
WIRE -256 -64 -272 -64
WIRE -208 -64 -208 -96
WIRE -208 -64 -256 -64
WIRE -160 -64 -208 -64
WIRE -128 -64 -160 -64
WIRE -32 -64 -48 -64
WIRE -32 -48 -32 -64
WIRE 48 -48 16 -48
WIRE -704 -32 -704 -64
WIRE -560 -32 -560 -64
WIRE -400 0 -400 -64
WIRE 16 48 16 32
WIRE 16 64 16 48
WIRE -400 96 -400 80
WIRE -400 96 -432 96
WIRE 16 160 16 144
WIRE -144 368 -208 368
WIRE 16 368 -64 368
WIRE 80 368 16 368
WIRE 16 384 16 368
WIRE -352 448 -368 448
WIRE -256 448 -272 448
WIRE -208 448 -208 368
WIRE 48 464 16 464
WIRE -688 544 -768 544
WIRE -656 544 -688 544
WIRE -544 544 -576 544
WIRE -496 544 -544 544
WIRE -400 544 -400 512
WIRE -400 544 -432 544
WIRE -368 544 -368 448
WIRE -368 544 -400 544
WIRE -352 544 -368 544
WIRE -256 544 -256 448
WIRE -256 544 -272 544
WIRE -208 544 -208 512
WIRE -208 544 -256 544
WIRE -160 544 -208 544
WIRE -128 544 -160 544
WIRE -32 544 -48 544
WIRE -32 560 -32 544
WIRE 48 560 16 560
WIRE -688 576 -688 544
WIRE -544 576 -544 544
WIRE -400 608 -400 544
WIRE 16 656 16 640
WIRE 16 672 16 656
WIRE -400 704 -400 688
WIRE -400 704 -432 704
WIRE 16 768 16 752
WIRE -144 864 -176 864
WIRE 16 864 -64 864
WIRE -144 960 -208 960
WIRE 16 960 16 864
WIRE 16 960 -64 960
WIRE 80 960 16 960
WIRE 16 976 16 960
WIRE -352 1040 -368 1040
WIRE -256 1040 -272 1040
WIRE -208 1040 -208 960
WIRE 48 1056 16 1056
WIRE -688 1136 -768 1136
WIRE -656 1136 -688 1136
WIRE -544 1136 -576 1136
WIRE -496 1136 -544 1136
WIRE -400 1136 -400 1104
WIRE -400 1136 -432 1136
WIRE -368 1136 -368 1040
WIRE -368 1136 -400 1136
WIRE -352 1136 -368 1136
WIRE -256 1136 -256 1040
WIRE -256 1136 -272 1136
WIRE -208 1136 -208 1104
WIRE -208 1136 -256 1136
WIRE -160 1136 -208 1136
WIRE -128 1136 -160 1136
WIRE -32 1136 -48 1136
WIRE -32 1152 -32 1136
WIRE 48 1152 16 1152
WIRE -688 1168 -688 1136
WIRE -544 1168 -544 1136
WIRE -400 1200 -400 1136
WIRE 16 1248 16 1232
WIRE 16 1264 16 1248
WIRE -400 1296 -400 1280
WIRE -400 1296 -432 1296
WIRE 16 1360 16 1344
WIRE -144 1536 -208 1536
WIRE 16 1536 -64 1536
WIRE 80 1536 16 1536
WIRE 16 1552 16 1536
WIRE -352 1616 -368 1616
WIRE -256 1616 -272 1616
WIRE -208 1616 -208 1536
WIRE 48 1632 16 1632
WIRE -688 1712 -768 1712
WIRE -656 1712 -688 1712
WIRE -544 1712 -576 1712
WIRE -496 1712 -544 1712
WIRE -400 1712 -400 1680
WIRE -400 1712 -432 1712
WIRE -368 1712 -368 1616
WIRE -368 1712 -400 1712
WIRE -352 1712 -368 1712
WIRE -256 1712 -256 1616
WIRE -256 1712 -272 1712
WIRE -208 1712 -208 1680
WIRE -208 1712 -256 1712
WIRE -160 1712 -208 1712
WIRE -128 1712 -160 1712
WIRE -32 1712 -48 1712
WIRE -32 1728 -32 1712
WIRE 48 1728 16 1728
WIRE -688 1744 -688 1712
WIRE -544 1744 -544 1712
WIRE -400 1776 -400 1712
WIRE 16 1824 16 1808
WIRE 16 1840 16 1824
WIRE -400 1872 -400 1856
WIRE -400 1872 -432 1872
WIRE 16 1936 16 1920
FLAG 16 160 0
FLAG -816 -1040 0
FLAG -2128 -1248 0
FLAG 80 -240 dp
FLAG -160 -64 g1p
FLAG 16 48 s1p
FLAG -816 -1184 t
FLAG -784 -64 in1p
FLAG -400 -96 b1p
FLAG -176 -336 VD
FLAG -432 96 VGbias
FLAG 80 -1072 0
FLAG -128 -1040 0
FLAG -656 -1040 0
FLAG -496 -1088 0
FLAG -304 -1120 VD
FLAG -2128 -1360 VD
FLAG -2000 -1360 VGbias
FLAG -208 -1264 dp
FLAG -208 -960 dn
FLAG 128 -1184 OUT
FLAG -2000 -1152 0
FLAG 1072 -704 0
FLAG 1296 -704 0
FLAG 1408 -720 0
FLAG 1392 -800 OUT_bpf
FLAG 16 768 0
FLAG 80 368 dp
FLAG -160 544 g2p
FLAG 16 656 s2p
FLAG -400 512 b2p
FLAG -432 704 VGbias
FLAG 16 1360 0
FLAG 80 960 dn
FLAG -160 1136 g1n
FLAG 16 1248 s1n
FLAG -400 1104 b1n
FLAG -176 864 VD
FLAG -432 1296 VGbias
FLAG 16 1936 0
FLAG 80 1536 dn
FLAG -160 1712 g2n
FLAG 16 1824 s2n
FLAG -400 1680 b2n
FLAG -432 1872 VGbias
FLAG -560 -1296 in1p
FLAG -560 -944 in1n
FLAG -560 48 0
FLAG -704 48 0
FLAG -768 544 in1p
FLAG -544 656 0
FLAG -688 656 0
FLAG -768 1136 in1n
FLAG -544 1248 0
FLAG -688 1248 0
FLAG -768 1712 in1n
FLAG -544 1824 0
FLAG -688 1824 0
FLAG 1552 -528 0
FLAG 560 -832 0
FLAG -1328 -272 0
FLAG -1328 -752 t
FLAG -896 -672 in1p
FLAG -896 -384 in1n
SYMBOL res 0 48 R0
SYMATTR InstName R1
SYMATTR Value {Rs}
SYMBOL res -48 -256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value {Rfb}
SYMBOL cap -224 -160 R0
SYMATTR InstName C1
SYMATTR Value {Cfb}
SYMBOL res -416 -16 R0
SYMATTR InstName R3
SYMATTR Value {Rgbias}
SYMBOL res -256 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value {Rg_damp}
SYMBOL ind -368 -144 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value {Lg_damp}
SYMBOL cap -432 -80 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value {Csource}
SYMBOL voltage -2128 -1344 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value {VD}
SYMBOL ind -160 -320 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L3
SYMATTR Value {Ld}
SYMBOL ind2 -224 -1248 R0
WINDOW 3 1 64 Right 2
SYMATTR Value {KOUT_LP}
SYMATTR InstName L5
SYMATTR Type ind
SYMATTR SpiceLine Rser=50m
SYMBOL ind2 -224 -1104 R0
WINDOW 3 -3 65 Right 2
SYMATTR Value {KOUT_LP}
SYMATTR InstName L6
SYMATTR Type ind
SYMATTR SpiceLine Rser=50m
SYMBOL ind2 -144 -1168 R0
SYMATTR InstName L7
SYMATTR Value {KOUT_LS}
SYMATTR Type ind
SYMBOL res 64 -1168 R0
SYMATTR InstName RL
SYMATTR Value {Rload_HV_SE}
SYMBOL ind2 -544 -1248 M0
WINDOW 3 -6 71 Right 2
SYMATTR Value {KIN_LS}
SYMATTR InstName L8
SYMATTR Type ind
SYMBOL ind2 -544 -1104 M0
WINDOW 3 -6 76 Right 2
SYMATTR Value {KIN_LS}
SYMATTR InstName L9
SYMATTR Type ind
SYMBOL ind2 -640 -1168 M0
SYMATTR InstName L10
SYMATTR Value {KIN_LP}
SYMATTR Type ind
SYMBOL voltage -2000 -1344 R0
WINDOW 3 24 96 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE({VG_init} {VG} {VG_tdelay} {VG_trise} {VG_trise} {VG_tpad*2+tpulse-VG_trise} 10m)
SYMATTR InstName V4
SYMBOL voltage -816 -1136 R0
WINDOW 3 -46 82 Invisible 2
WINDOW 123 -40 28 Right 2
WINDOW 39 -45 52 Right 2
SYMATTR Value SINE(0 {Vin} {f0} {VG_tdelay+VG_tpad} 0 0 {tpulse*f0})
SYMATTR Value2 AC 1
SYMATTR SpiceLine Rser={Rsource_HV_SE}
SYMATTR InstName V2
SYMBOL bv -2000 -1248 R0
SYMATTR InstName B1
SYMATTR Value V={VG*smallsig()}
SYMBOL bv 1072 -800 R0
SYMATTR InstName B2
SYMATTR Value V=V(OUT)
SYMBOL res 1280 -816 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 1
SYMBOL ind 1280 -800 R0
SYMATTR InstName L15
SYMATTR Value {bpf_L}
SYMBOL cap 1392 -784 R0
SYMATTR InstName C9
SYMATTR Value {bpf_C}
SYMBOL nmos -32 -144 R0
SYMATTR InstName M1
SYMATTR Value irf630
SYMATTR Prefix X
SYMBOL ind 0 -64 R0
SYMATTR InstName L17
SYMATTR Value {Lpar_S}
SYMATTR SpiceLine Rpar={EPR_S}
SYMBOL ind 0 -240 R0
SYMATTR InstName L18
SYMATTR Value {Lpar_D}
SYMATTR SpiceLine Rpar={EPR_D}
SYMBOL ind -144 -48 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L19
SYMATTR Value {Lpar_G}
SYMATTR SpiceLine Rpar={EPR_G}
SYMBOL res 0 656 R0
SYMATTR InstName R18
SYMATTR Value {Rs}
SYMBOL res -48 352 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value {Rfb}
SYMBOL cap -224 448 R0
SYMATTR InstName C10
SYMATTR Value {Cfb}
SYMBOL res -416 592 R0
SYMATTR InstName R20
SYMATTR Value {Rgbias}
SYMBOL res -256 528 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value {Rg_damp}
SYMBOL ind -368 464 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L16
SYMATTR Value {Lg_damp}
SYMBOL cap -432 528 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C11
SYMATTR Value {Csource}
SYMBOL nmos -32 464 R0
SYMATTR InstName M2
SYMATTR Value irf630
SYMATTR Prefix X
SYMBOL ind 0 544 R0
SYMATTR InstName L21
SYMATTR Value {Lpar_S}
SYMATTR SpiceLine Rpar={EPR_S}
SYMBOL ind 0 368 R0
SYMATTR InstName L22
SYMATTR Value {Lpar_D}
SYMATTR SpiceLine Rpar={EPR_D}
SYMBOL ind -144 560 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L23
SYMATTR Value {Lpar_G}
SYMATTR SpiceLine Rpar={EPR_G}
SYMBOL res 0 1248 R0
SYMATTR InstName R5
SYMATTR Value {Rs}
SYMBOL res -48 944 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value {Rfb}
SYMBOL cap -224 1040 R0
SYMATTR InstName C3
SYMATTR Value {Cfb}
SYMBOL res -416 1184 R0
SYMATTR InstName R7
SYMATTR Value {Rgbias}
SYMBOL res -256 1120 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value {Rg_damp}
SYMBOL ind -368 1056 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L2
SYMATTR Value {Lg_damp}
SYMBOL cap -432 1120 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value {Csource}
SYMBOL ind -160 880 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L4
SYMATTR Value {Ld}
SYMBOL nmos -32 1056 R0
SYMATTR InstName M3
SYMATTR Value irf630
SYMATTR Prefix X
SYMBOL ind 0 1136 R0
SYMATTR InstName L11
SYMATTR Value {Lpar_S}
SYMATTR SpiceLine Rpar={EPR_S}
SYMBOL ind 0 960 R0
SYMATTR InstName L12
SYMATTR Value {Lpar_D}
SYMATTR SpiceLine Rpar={EPR_D}
SYMBOL ind -144 1152 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L13
SYMATTR Value {Lpar_G}
SYMATTR SpiceLine Rpar={EPR_G}
SYMBOL res 0 1824 R0
SYMATTR InstName R9
SYMATTR Value {Rs}
SYMBOL res -48 1520 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value {Rfb}
SYMBOL cap -224 1616 R0
SYMATTR InstName C5
SYMATTR Value {Cfb}
SYMBOL res -416 1760 R0
SYMATTR InstName R11
SYMATTR Value {Rgbias}
SYMBOL res -256 1696 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value {Rg_damp}
SYMBOL ind -368 1632 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L14
SYMATTR Value {Lg_damp}
SYMBOL cap -432 1696 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C6
SYMATTR Value {Csource}
SYMBOL nmos -32 1632 R0
SYMATTR InstName M4
SYMATTR Value irf630
SYMATTR Prefix X
SYMBOL ind 0 1712 R0
SYMATTR InstName L25
SYMATTR Value {Lpar_S}
SYMATTR SpiceLine Rpar={EPR_S}
SYMBOL ind 0 1536 R0
SYMATTR InstName L26
SYMATTR Value {Lpar_D}
SYMATTR SpiceLine Rpar={EPR_D}
SYMBOL ind -144 1728 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L27
SYMATTR Value {Lpar_G}
SYMATTR SpiceLine Rpar={EPR_G}
SYMBOL res -720 -48 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_in}
SYMATTR InstName R13
SYMBOL res -576 -48 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_out}
SYMATTR InstName R14
SYMBOL res -576 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -53 65 VTop 2
SYMATTR InstName R15
SYMATTR Value {atten_Rser}
SYMBOL res -704 560 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_in}
SYMATTR InstName R16
SYMBOL res -560 560 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_out}
SYMATTR InstName R22
SYMBOL res -560 528 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -53 65 VTop 2
SYMATTR InstName R23
SYMATTR Value {atten_Rser}
SYMBOL res -704 1152 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_in}
SYMATTR InstName R24
SYMBOL res -560 1152 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_out}
SYMATTR InstName R25
SYMBOL res -560 1120 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -53 65 VTop 2
SYMATTR InstName R26
SYMATTR Value {atten_Rser}
SYMBOL res -704 1728 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_in}
SYMATTR InstName R27
SYMBOL res -560 1728 R0
WINDOW 3 -18 39 VRight 2
SYMATTR Value {atten_Rshunt_out}
SYMATTR InstName R28
SYMBOL res -560 1696 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -53 65 VTop 2
SYMATTR InstName R29
SYMATTR Value {atten_Rser}
SYMBOL ind2 -1376 -736 M0
WINDOW 3 -164 29 Right 2
SYMATTR Value {T1_Lmag}
SYMATTR InstName L101
SYMATTR Type ind
SYMBOL cap -1360 -704 R0
WINDOW 3 155 31 Left 2
SYMATTR InstName C7
SYMATTR Value {T1_Cp}
SYMBOL res -1296 -736 R0
WINDOW 3 83 89 Left 2
SYMATTR InstName R30
SYMATTR Value {T1_Rmag}
SYMBOL ind2 -1376 -624 M0
WINDOW 3 -164 29 Right 2
SYMATTR Value {T1_Lmag}
SYMATTR InstName L102
SYMATTR Type ind
SYMBOL cap -1360 -592 R0
WINDOW 3 155 31 Left 2
SYMATTR InstName C8
SYMATTR Value {T1_Cp}
SYMBOL res -1296 -624 R0
WINDOW 3 83 89 Left 2
SYMATTR InstName R31
SYMATTR Value {T1_Rmag}
SYMBOL ind2 -1376 -512 M0
WINDOW 3 -164 29 Right 2
SYMATTR Value {T1_Lmag}
SYMATTR InstName L103
SYMATTR Type ind
SYMBOL cap -1360 -480 R0
WINDOW 3 155 31 Left 2
SYMATTR InstName C12
SYMATTR Value {T1_Cp}
SYMBOL res -1296 -512 R0
WINDOW 3 83 89 Left 2
SYMATTR InstName R32
SYMATTR Value {T1_Rmag}
SYMBOL ind2 -1376 -400 M0
WINDOW 3 -164 29 Right 2
SYMATTR Value {T1_Lmag}
SYMATTR InstName L104
SYMATTR Type ind
SYMBOL cap -1360 -368 R0
WINDOW 3 155 31 Left 2
SYMATTR InstName C13
SYMATTR Value {T1_Cp}
SYMBOL res -1296 -400 R0
WINDOW 3 83 89 Left 2
SYMATTR InstName R33
SYMATTR Value {T1_Rmag}
SYMBOL ind2 -992 -640 M0
WINDOW 3 -164 29 Right 2
SYMATTR Value {T1_Lmag}
SYMATTR InstName L105
SYMATTR Type ind
SYMBOL cap -976 -608 R0
WINDOW 3 155 31 Left 2
SYMATTR InstName C14
SYMATTR Value {T1_Cp}
SYMBOL res -912 -640 R0
WINDOW 3 83 89 Left 2
SYMATTR InstName R34
SYMATTR Value {T1_Rmag}
SYMBOL ind2 -992 -528 M0
WINDOW 3 -164 29 Right 2
SYMATTR Value {T1_Lmag}
SYMATTR InstName L106
SYMATTR Type ind
SYMBOL cap -976 -496 R0
WINDOW 3 155 31 Left 2
SYMATTR InstName C15
SYMATTR Value {T1_Cp}
SYMBOL res -912 -528 R0
WINDOW 3 83 89 Left 2
SYMATTR InstName R35
SYMATTR Value {T1_Rmag}
TEXT 904 -448 Left 2 !.param Rg_damp=15\n.param Lg_damp=47n
TEXT 960 -240 Left 2 !.net I(RL) V2\n.ac dec 1k 100k 200meg\n;.tran 0 {VG_tdelay+VG_tpad+50u+10/f0} {VG_tdelay+VG_tpad+50u} 1u\n \n; FOR MEASURING COMPRESSION\n;.step oct param Vin_scale 0.0625 1 4\n.meas TRAN Vout_RMS_fund RMS V(OUT_bpf)\n.meas TRAN Av_fund RMS {V(OUT_bpf)/(Vin/1.414)}\n.meas TRAN Pout_fund PARAM {(Vout_RMS_fund**2/Rload_HV_SE)}\n.meas TRAN G_dB PARAM 20*log10(Av_fund)\n.meas TRAN Pbias AVG -V(VD)*I(V1)\n.meas TRAN Efficiency PARAM Pout_fund/Pbias\n \n; SPICE models/subcircuits to include\n.inc /Models and subcircuits/all_hexfet_subcircuits.inc
TEXT 640 -1688 Left 2 ;trace formulas\nTransconductance of FET Gm0\nIx(M1:D)/V(g,s)\nEffective transconductance Gm\nIx(M1:D)/V(g)\nStability factor\n(1-abs(S11(v2))**2-abs(S22(v2))**2+abs(S11(v2)*S22(v2)-S12(v2)*S21(v2))**2)/(2*abs(S21(v2)*S12(v2)))\njust delta\nS11(v2)*S22(v2)-S12(v2)*S21(v2)
TEXT -2240 128 Left 2 !;step 1:\n;Choose :\n;Nfets (number of FETs sharing PEP)\n.param Nfets=4\n.param PEPnet_target=200\n.param Rload_net=50\n;PEP (peak output power) \n;VD (drain bias voltage)\n;VDmin (minimum drain voltage of FET, at max amplitude)\n.param PEP_target={PEPnet_target/Nfets}\n.param VD_target=48\n.param VDmin_target=12\n;Voutpk=VD_target-VDmin_target\n.param Voutpk_target={VD_target-VDmin_target}\n;Rload_LV_SE=Voutpk_target^2/(2*PEP_target)\n.param Rload_LV_SE_target={Voutpk_target**2/(2*PEP_target)}\n \n \n;step 1.1 \n; can use the exact target Rload_LV_SE_target\n.param Rload_LV_SE={Rload_LV_SE_target}\n.param VD=VD_target\n.param PEP=PEP_target\n.param Voutpk=Voutpk_target\n.param VDmin=VDmin_target\n \n; or override it with something realizable with the transformers\n; if I override Rload, then PEP will be allowed  to change\n;.param Rload_LV_SE=12.5\n;.param PEP={PEP_target*Rload_LV_SE/Rload_LV_SE_target}\n; and recalculate other things\n;.param Voutpk={sqrt(Rload_LV_SE*2*PEP_target)}\n;.param VD=VD_target\n;.param VDmin={VD-Voutpk}\n \n;For impedance match on output, set Rout_LV_SE=Rload_LV_SE\n.param Rout_LV_SE={Rload_LV_SE}\n \n;step 2:\n; choose IDmin (minimum drain current of FET, at max amplitude)\n.param IDmin=0.5\n; ID=IDmin+Voutpk/Rload_LV_SE\n.param ID={IDmin+Voutpk/Rload_LV_SE}\n; given Gm0, the Gm of the FET at ID\n; and choose Gm, between 0.1Gm0 and 0.5Gm0\n;.param Gm0=2\n.param Gm=1\n; source resistor Rs=(Gm0-Gm)/(Gm0*Gm)\n.param Rs={(Gm0-Gm)/(Gm0*Gm)}\n; calculate gate bias voltage\n; Vth depends on MOSFET model\n.param VG={ID*Rs+Vth}\n \n;step 3:\n; choose gate bias resistor Rgbias\n.param Rgbias=100\n; choose source resistance\n.param Rsource_LV_SE=12.5\n; in parallel they make Rsource2\n.param Rsource2_LV_SE = {(Rgbias*Rsource_LV_SE)/(Rgbias+Rsource_LV_SE)}\n; calculate feedback resistance Rfb\n.param Rfb=Rout_LV_SE*(1+Gm*Rsource2_LV_SE)-Rsource2_LV_SE\n \n;step 4:\n; choose f0/w0\n.param f0=5.1e6\n.param w0={2*3.14159*f0}\n; calculate blocking caps\n; choose cutoff fc=f0/fcratio\n.param fcratio_fb=10\n.param fcratio_source=10\n;.param fc={f0/fcratio}\n;.param wc={w0/fcratio}\n.param Cfb={fcratio_fb/(w0*Rfb)}\n.param Csource={fcratio_source/(w0*Rsource_LV_SE)}\n; calculate drain bias inductor to cancel Coss\n;.param Coss=100p\n.param Ld={1/w0**2/(Coss*Nfets/2)}\n \n; calculate Rin, looking from Rsource\n.param Rin_LV_SE={Rgbias*(Rfb+Rload_LV_SE)/(Rgbias*(Gm*Rload_LV_SE+1)+Rfb+Rload_LV_SE)}
TEXT 968 312 Left 2 !.meas PEP PARAM {PEP}\n.meas VD PARAM {VD}\n.meas VDmin PARAM {VDmin}\n.meas Rload_LV_SE_target PARAM {Rload_LV_SE_target}\n.meas Rload_LV_SE PARAM {Rload_LV_SE}\n.meas IDmin PARAM {IDmin}\n.meas ID PARAM {ID}\n.meas Gm0 PARAM {Gm0}\n.meas Gm PARAM {Gm}\n.meas Rs PARAM {Rs}\n.meas Rgbias PARAM {Rgbias}\n.meas Rsource_LV_SE PARAM {Rsource_LV_SE}\n.meas Rfb PARAM {Rfb}\n.meas Cfb PARAM {Cfb}\n.meas Csource PARAM {Csource}\n.meas Rin_LV_SE PARAM {Rin_LV_SE}\n.meas VG PARAM {VG}\n.meas Coss PARAM {Coss}\n.meas Ld PARAM {Ld}\n.meas KIN_LP PARAM {KIN_LP}\n.meas KIN_LS PARAM {KIN_LS}\n.meas KOUT_LP PARAM {KOUT_LP}\n.meas KOUT_LS PARAM {KOUT_LS}\n.meas Rload_HV_SE PARAM {Rload_HV_SE}\n.meas Rsource_HV_SE PARAM {Rsource_HV_SE}
TEXT -256 -1592 Left 2 !KOUT L5 L6 L7 1\n;inductance per each unit winding\n.param KOUT_AL=10u\n;winding on each side of low voltage center-tapped side\n.param KOUT_N_LV=1\n.param KOUT_N_HV=4\n.param KOUT_LP={KOUT_N_LV**2*KOUT_AL}\n.param KOUT_LS={KOUT_N_HV**2*KOUT_AL}\n.param Rload_HV_SE={2*Rload_LV_SE*KOUT_LS/(4*KOUT_LP)/(Nfets/2)}
TEXT -1184 -1600 Left 2 !KIN L10 L8 L9 1\n;inductance per each unit winding\n.param KIN_AL=10u\n;winding on each side of low voltage center-tapped side\n.param KIN_N_LV=1\n.param KIN_N_HV=4\n.param KIN_LP={KIN_N_HV**2*KOUT_AL}\n.param KIN_LS={KIN_N_LV**2*KOUT_AL}\n.param Rsource_HV_SE={2*Rsource_LV_SE*KIN_LP/(4*KIN_LS)/(Nfets/2)}
TEXT -2240 -1096 Left 2 !.param tpulse=1m\n.param VG_tpad=50u\n.param VG_trise=10u\n.param VG_tdelay=50u\n.param VG_init = 0
TEXT -1016 -976 Left 2 !.param Vin_scale=1\n.param Vin={20*Vin_scale}
TEXT 1120 -656 Left 2 !.param bpf_Q=10\n.param bpf_C={bpf_Q/(w0)}\n.param bpf_L={1/(bpf_Q*w0)}
TEXT 376 520 Left 2 !.param Lpar_S=7.5n\n.param EPR_S=100\n.param Lpar_D=4.5n\n.param EPR_D=100\n.param Lpar_G=7.5n\n.param EPR_G=100
TEXT -736 2128 Left 2 !.param atten_Rin={Rsource_LV_SE}\n.param atten_Rout={Rsource_LV_SE}\n;.param atten_Rin=12.5\n;.param atten_Rout=12.5\n.param atten_dB=3\n;atten_Rin\n;atten_Rout\n;atten_Vout\n.param atten_Vout={sqrt(atten_Rout/atten_Rin/(10**(atten_dB*0.1)))}\n;.param atten_Rshunt_in={((atten_Rout*atten_Rin)-(atten_Rin**2)*(atten_Vout**2))}\n.param atten_Rshunt_in={((atten_Rout*atten_Rin)-(atten_Rin**2)*(atten_Vout**2))/(atten_Rout+(atten_Rin*atten_Vout**2)-(2*atten_Rin*atten_Vout))}\n.param atten_Rshunt_out={atten_Vout/(1/atten_Rin-atten_Vout/atten_Rout-1/atten_Rshunt_in)}\n.param atten_Rser={((1-atten_Vout)*(atten_Rin*atten_Rshunt_in))/(atten_Rshunt_in-atten_Rin)}\n.meas atten_Vout PARAM {atten_Vout}\n.meas atten_Rshunt_in PARAM {atten_Rshunt_in}\n.meas atten_Rshunt_out PARAM {atten_Rshunt_out}\n.meas atten_Rser PARAM {atten_Rser}
TEXT 1280 -896 Center 2 ;BPF for measuring fundamental \ncomponent of RFPA output
TEXT -648 -1656 Left 2 ;Input/output transformer baluns
TEXT 1808 -1016 Left 2 !;.include /FET_bias_conditions/fetprops_irf510_ID_1p0.inc\n;.include /FET_bias_conditions/fetprops_irf520_ID_1p0.inc\n;.include /FET_bias_conditions/fetprops_irf520n_ID_1p0.inc\n;.include /FET_bias_conditions/fetprops_irf530_ID_1p0.inc\n;.include /FET_bias_conditions/fetprops_irf530n_ID_1p0.inc\n;.include /FET_bias_conditions/fetprops_irf540n_ID_1p0.inc\n;.include /FET_bias_conditions/fetprops_irf630_ID_1p0.inc\n;.include /FET_bias_conditions/fetprops_irf630n_ID_1p0.inc\n \n;.include /FET_bias_conditions/fetprops_irf510_ID_3p1.inc\n;.include /FET_bias_conditions/fetprops_irf520_ID_3p1.inc\n;.include /FET_bias_conditions/fetprops_irf520n_ID_3p1.inc\n;.include /FET_bias_conditions/fetprops_irf530_ID_3p1.inc\n;.include /FET_bias_conditions/fetprops_irf530n_ID_3p1.inc\n;.include /FET_bias_conditions/fetprops_irf540n_ID_3p1.inc\n.include /FET_bias_conditions/fetprops_irf630_ID_3p1.inc\n;.include /FET_bias_conditions/fetprops_irf630n_ID_3p1.inc
TEXT 440 1000 Left 2 !; measurements of AC response\n; get some network parameters at f0\n.meas f0 PARAM {f0}\n.meas AC S21_at_f0 FIND mag(S21(v2)) AT f0\n.meas AC S11_at_f0 FIND mag(S11(v2)) AT f0\n.meas AC S22_at_f0 FIND mag(S22(v2)) AT f0\n.meas AC kstab_at_f0 FIND kstab(S11(v2),S21(v2),S12(v2),S22(v2)) AT f0\n;also give Zin and Zout at f0. But output will be in dB/phase....\n.meas AC Zin_at_f0 FIND mag(Zin(v2)) AT f0\n.meas AC Zout_at_f0 FIND mag(Zout(v2)) AT f0\n \n \n; find the actual peak of S21\n.MEAS AC S21_at_S21_max max mag(S21(v2)); find the peak response\n.MEAS AC f_at_S21_max when mag(S21(v2))=(S21_at_S21_max)\n \n; find the minimum kstab\n.MEAS AC kstab_at_stab_min min kstab(S11(v2),S21(v2),S12(v2),S22(v2))\n.MEAS AC f_at_kstab_min when kstab(S11(v2),S21(v2),S12(v2),S22(v2))=(kstab_at_stab_min)
TEXT 184 96 Left 2 !.func kstab(S11,S21,S12,S22) {(1-abs(S11)**2-abs(S22)**2+abs(S11*S22-S12*S21)**2)/(2*abs(S21*S12))}
TEXT -648 -760 Left 2 !.param T1_Lmag=12.3u\n.param T1_Cp=800p\n.param T1_K=0.996\n.param T1_Rmag=1.099K\nK100 L101 L102 L103 L104 L105 L106 {T1_K}
